{"version":3,"file":"rangePlugin.js","sources":["../../src/plugins/rangePlugin.ts"],"sourcesContent":["import { Plugin } from \"../types/options\";\n\nexport interface Config {\n  input?: string | HTMLInputElement;\n  position?: \"left\";\n}\n\ndeclare global {\n  interface Window {\n    rangePlugin: (config?: Config) => void;\n  }\n}\n\nfunction rangePlugin(config: Config = {}): Plugin {\n  return function (fp) {\n    let dateFormat = \"\",\n      secondInput: HTMLInputElement,\n      _secondInputFocused: boolean,\n      _prevDates: Date[];\n\n    const createSecondInput = () => {\n      if (config.input) {\n        secondInput =\n          config.input instanceof Element\n            ? config.input\n            : (window.document.querySelector(config.input) as HTMLInputElement);\n\n        if (!secondInput) {\n          fp.config.errorHandler(new Error(\"Invalid input element specified\"));\n          return;\n        }\n\n        if (fp.config.wrap) {\n          secondInput = secondInput.querySelector(\n            \"[data-input]\"\n          ) as HTMLInputElement;\n        }\n      } else {\n        secondInput = fp._input.cloneNode() as HTMLInputElement;\n        secondInput.removeAttribute(\"id\");\n        secondInput._flatpickr = undefined;\n      }\n\n      if (secondInput.value) {\n        const parsedDate = fp.parseDate(secondInput.value);\n\n        if (parsedDate) fp.selectedDates.push(parsedDate);\n      }\n\n      secondInput.setAttribute(\"data-fp-omit\", \"\");\n\n      if (fp.config.clickOpens) {\n        fp._bind(secondInput, [\"focus\", \"click\"], () => {\n          if (fp.selectedDates[1]) {\n            fp.latestSelectedDateObj = fp.selectedDates[1];\n            fp._setHoursFromDate(fp.selectedDates[1]);\n            fp.jumpToDate(fp.selectedDates[1]);\n          }\n\n          _secondInputFocused = true;\n          fp.isOpen = false;\n          fp.open(\n            undefined,\n            config.position === \"left\" ? fp._input : secondInput\n          );\n        });\n\n        fp._bind(fp._input, [\"focus\", \"click\"], (e: FocusEvent) => {\n          e.preventDefault();\n          fp.isOpen = false;\n          fp.open();\n        });\n      }\n\n      if (fp.config.allowInput)\n        fp._bind(secondInput, \"keydown\", (e: KeyboardEvent) => {\n          if ((e as KeyboardEvent).key === \"Enter\") {\n            fp.setDate(\n              [fp.selectedDates[0], secondInput.value],\n              true,\n              dateFormat\n            );\n            secondInput.click();\n          }\n        });\n\n      if (!config.input)\n        fp._input.parentNode &&\n          fp._input.parentNode.insertBefore(secondInput, fp._input.nextSibling);\n    };\n\n    const plugin = {\n      onParseConfig() {\n        fp.config.mode = \"range\";\n\n        dateFormat = fp.config.altInput\n          ? fp.config.altFormat\n          : fp.config.dateFormat;\n      },\n\n      onReady() {\n        createSecondInput();\n        fp.config.ignoredFocusElements.push(secondInput);\n        if (fp.config.allowInput) {\n          fp._input.removeAttribute(\"readonly\");\n          secondInput.removeAttribute(\"readonly\");\n        } else {\n          secondInput.setAttribute(\"readonly\", \"readonly\");\n        }\n\n        fp._bind(fp._input, \"focus\", () => {\n          fp.latestSelectedDateObj = fp.selectedDates[0];\n          fp._setHoursFromDate(fp.selectedDates[0]);\n          _secondInputFocused = false;\n          fp.jumpToDate(fp.selectedDates[0]);\n        });\n\n        if (fp.config.allowInput)\n          fp._bind(fp._input, \"keydown\", (e: KeyboardEvent) => {\n            if ((e as KeyboardEvent).key === \"Enter\")\n              fp.setDate(\n                [fp._input.value, fp.selectedDates[1]],\n                true,\n                dateFormat\n              );\n          });\n\n        fp.setDate(fp.selectedDates, false);\n        plugin.onValueUpdate(fp.selectedDates);\n        fp.loadedPlugins.push(\"range\");\n      },\n\n      onPreCalendarPosition() {\n        if (_secondInputFocused) {\n          fp._positionElement = secondInput;\n          setTimeout(() => {\n            fp._positionElement = fp._input;\n          }, 0);\n        }\n      },\n\n      onChange() {\n        if (!fp.selectedDates.length) {\n          setTimeout(() => {\n            if (fp.selectedDates.length) return;\n\n            secondInput.value = \"\";\n            _prevDates = [];\n          }, 10);\n        }\n\n        if (_secondInputFocused) {\n          setTimeout(() => {\n            secondInput.focus();\n          }, 0);\n        }\n      },\n\n      onDestroy() {\n        if (!config.input)\n          secondInput.parentNode &&\n            secondInput.parentNode.removeChild(secondInput);\n      },\n\n      onValueUpdate(selDates: Date[]) {\n        if (!secondInput) return;\n\n        _prevDates =\n          !_prevDates || selDates.length >= _prevDates.length\n            ? [...selDates]\n            : _prevDates;\n\n        if (_prevDates.length > selDates.length) {\n          const newSelectedDate = selDates[0];\n          const newDates = _secondInputFocused\n            ? [_prevDates[0], newSelectedDate]\n            : [newSelectedDate, _prevDates[1]];\n\n          if (newDates[0].getTime() > newDates[1].getTime()) {\n            if (_secondInputFocused) {\n              newDates[0] = newDates[1];\n            } else {\n              newDates[1] = newDates[0];\n            }\n          }\n\n          fp.setDate(newDates, false);\n          _prevDates = [...newDates];\n        }\n\n        [\n          fp._input.value = \"\",\n          secondInput.value = \"\",\n        ] = fp.selectedDates.map((d) => fp.formatDate(d, dateFormat));\n      },\n    };\n\n    return plugin;\n  };\n}\n\nexport default rangePlugin;\n"],"names":[],"mappings":"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"}